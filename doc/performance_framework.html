<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mir: Mir performance framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mir
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Mir performance framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to facilitate writing portable and easy to share performance tests, Mir provides a performance framework written in python3.</p>
<p>Each test, along with code to process the test results, is contained in a single python3 script which uses the Mir performance framework modules.</p>
<h2>Invoking tests </h2>
<p>To run a test, just execute the python3 script containing it.</p>
<p>We need to ensure that the Mir performance framework can be found by python. If you have installed the Mir performance framework to one of the standard python3 library locations (e.g., with make install or a package installation), then the framework should be automatically detected. If you are using the framework from within the source tree you need to add the directory containing the mir_perf_framework/ directory (i.e., its parent directory) to the PYTHONPATH env. variable: </p><pre class="fragment">sudo PYTHONPATH=/path/to/mir/benchmarks python3 testscript.py
</pre><p>If you are using an Ubuntu system the framework comes pre-packaged in the python3-mir-perf-framework package, which, besides the framework itself, also installs a few interesting tests in /usr/share/mir-perf-framework/.</p>
<h2>Writing test scripts </h2>
<h3>Specifying the test configuration</h3>
<p>To create a test we first need to instantiate objects representing the servers and clients we want to run as part of the test, and also the kind of LTTng reports we want to enable for each one of them: </p><pre class="fragment">from mir_perf_framework import Server, Client
host = Server()
nested = Server(...)
client = Client(...)
</pre><h3>Specifying the executable to run</h3>
<p>By default the servers use the 'mir_demo_server' executable and the clients the 'mir_demo_client_egltriangle' executable. We can override this by using the 'executable' option. We can also set custom command line arguments to use when invoking the executable (even the default ones). Finally we can set extra environment variables using the 'env' option, which is a dictionary of variable names and values. </p><pre class="fragment"> server = Server(executable=shutil.which("my_test_server"),
                 options=["--window-manager", "fullscreen"],
                 env = {"MIR_SERVER_MY_OPTION": "on"})
</pre><h3>Specifying the host server a server should connect to</h3>
<p>By default a server is started in host mode. If we want to create a nested server we need to set the host server it will connect to by using the 'host' option: </p><pre class="fragment">host = Server()
nested = Server(host=host)
</pre><h3>Specifying the server a should connect to</h3>
<p>A client needs to know the server to connect to. This is set with the 'server' option: </p><pre class="fragment">host = Server()
client = Client(server=host)
</pre><h3>Specifying the lttng reports to enable</h3>
<p>To enable an LTTng report add it to the list passed to the 'reports' option. To enable a client report (which only makes sense for clients or nested servers), prefix them with 'client-': </p><pre class="fragment">nested = Server(host=host, reports=["compositor", "client-input-receiver"])
client = Client(server=nested, reports=["client-input-receiver"])
</pre><h2>Starting and stopping the test </h2>
<p>After we have instantiated objects representing our test setup, we need to create a PerformanceTest using these objects: </p><pre class="fragment">from mir_perf_framework import Server, Client, PerformanceTest
...
test = PerformanceTest([host, nested, client])
</pre><p>Note that the order of the objects in the list matters, since server/clients are created and run in list order when the test is started.</p>
<p>To start the test use the start() method, and after finishing stop it using the stop() method: </p><pre class="fragment">test = PerformanceTest([host, nested, client])
test.start()
...
test.stop()
</pre><h2>Simulating input events </h2>
<p>To simulate input events during tests, you can use the evdev python3 module. </p><pre class="fragment">import evdev

ui = evdev.UInput()

# during testing ...
ui.write(evdev.ecodes.EV_KEY, evdev.ecodes.KEY_A, 1)
ui.syn()
</pre><h2>Accessing LTTng events </h2>
<p>After the test has finished (i.e., after it has been stop()-ed), we can access the recorded LTTng events in two ways. The first is to get the raw babeltrace trace object and extract the data from it: </p><pre class="fragment">### NOT RECOMMENDED unless you know what you are doing
### use test.events() instead
trace = test.babeltrace()

for event in trace.events:
    print(event.name)
    interesting_event = event # This works, but interesting_event will
                            # contain invalid contents later.

print(trace.events[i].name) # Random access is not supported.
</pre><p>Unfortunately, accessing events this way has two severe limitations. First, only sequential access is supported, and, second, we are allowed to access only one event at a time (the active iteration event), since references to other events do not remain valid after we have moved on.</p>
<p>To make life easier, the PerformanceTest object offers the events() method, which returns all the LTTng events in a normal, random-access capable python list. </p><pre class="fragment">events = test.events()

for event in events:
    print(event.name)
    interesting_event = event # OK! Interesting event is always valid.

print(events[i].name) # Random access is OK too!
</pre><p>This is the recommend way of accessing the events, unless you need some functionality offered only by the babeltrace APIs. Note, however, that creating the list of events may incur a small delay. </p>
</div></div><!-- contents -->
<hr>
<p align="center">Copyright &copy; 2012-2017
 Canonical Ltd. <br />
Generated on Thu  9 Nov 11:54:24 UTC 2017
</p>
</body>
</html>
